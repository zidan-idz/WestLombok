<!-- Mobile Menu Overlay -->
<div id="mobile-menu" class="fixed inset-0 bg-black z-[99999] hidden flex flex-col">
    
    <!-- Header Bar (Logo + Close) - Matching Navbar Layout -->
    <div class="w-full py-6">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <span class="font-oswald font-bold text-2xl text-white tracking-widest uppercase">West Lombok</span>
            <button id="mobile-close-btn" class="text-white focus:outline-none hover:text-gray-300 transition-colors">
                <span class="material-icons text-3xl">close</span>
            </button>
        </div>
    </div>

    <!-- Centered Navigation -->
    <nav class="flex-1 flex flex-col items-center justify-center px-8">
        <ul class="space-y-6 text-center">
            <li><a href="{% url 'base:home' %}" class="block text-white text-3xl font-oswald font-bold tracking-wider uppercase hover:text-gray-400 transition-colors duration-200 mobile-link">Home</a></li>
            <li><a href="{% url 'core:destination_list' %}" class="block text-white text-3xl font-oswald font-bold tracking-wider uppercase hover:text-gray-400 transition-colors duration-200 mobile-link">Destinations</a></li>
            <li><a href="{% url 'core:category_list' %}" class="block text-white text-3xl font-oswald font-bold tracking-wider uppercase hover:text-gray-400 transition-colors duration-200 mobile-link">Categories</a></li>
            <li><a href="{% url 'core:surprise_me' %}" class="block text-white text-3xl font-oswald font-bold tracking-wider uppercase hover:text-gray-400 transition-colors duration-200 mobile-link">Surprise Me</a></li>
            <li><a href="{% url 'base:about' %}" class="block text-white text-3xl font-oswald font-bold tracking-wider uppercase hover:text-gray-400 transition-colors duration-200 mobile-link">About</a></li>
        </ul>
        
        <div class="mt-12">
            {% if user.is_authenticated and user.is_staff %}
            <a href="/admin/" class="inline-block border-2 border-white text-white px-10 py-3 text-sm font-oswald font-bold tracking-widest uppercase hover:bg-white hover:text-black transition-all duration-200 mobile-link">Dashboard</a>
            {% else %}
            <a href="/admin/" class="inline-block border-2 border-white text-white px-10 py-3 text-sm font-oswald font-bold tracking-widest uppercase hover:bg-white hover:text-black transition-all duration-200 mobile-link">Log In</a>
            {% endif %}
        </div>
    </nav>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuBtn = document.getElementById('mobile-menu-btn'); // Dom element di navbar.html
        const closeBtn = document.getElementById('mobile-close-btn');
        const menu = document.getElementById('mobile-menu');
        const links = document.querySelectorAll('.mobile-link');
        
        // State untuk mencegah spam klik
        let isAnimating = false;

        if (!menuBtn || !closeBtn || !menu) {
            console.warn("Mobile menu elements missing (MenuBtn: " + (menuBtn ? "OK" : "Missing") + ")");
            return;
        }

        function openMenu() {
            if (isAnimating) return;
            isAnimating = true;

            // 1. Prepare State
            menu.classList.remove('hidden');
            menu.style.opacity = '0'; // Ensure start from 0
            document.body.style.overflow = 'hidden'; // Lock Scroll

            // 2. Animate Overlay In
            anime({
                targets: menu,
                opacity: [0, 1],
                duration: 400,
                easing: 'easeOutQuad',
                complete: () => { isAnimating = false; }
            });

            // 3. Hide Hamburger Button smoothly
            anime({
                targets: menuBtn,
                opacity: 0,
                duration: 300,
                easing: 'easeOutQuad'
            });

            // 4. Stagger Links In (Efek Premium)
            anime({
                targets: '.mobile-link',
                translateY: [20, 0],
                opacity: [0, 1],
                delay: anime.stagger(100, {start: 100}), // Delay start agar overlay muncul dulu
                easing: 'easeOutExpo'
            });
        }

        function closeMenu() {
            if (isAnimating) return;
            isAnimating = true;

            // 1. Animate Overlay Out
            anime({
                targets: menu,
                opacity: [1, 0],
                duration: 300,
                easing: 'easeInQuad',
                complete: () => {
                    // Only hide after animation completes
                    menu.classList.add('hidden');
                    document.body.style.overflow = ''; // Critical: Unlock scroll
                    isAnimating = false;
                }
            });

            // 2. Show Hamburger Button back
            anime({
                targets: menuBtn,
                opacity: 1,
                duration: 300,
                easing: 'easeOutQuad'
            });
        }

        // Event Listeners
        menuBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openMenu();
        });

        closeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            closeMenu();
        });

        // Close menu when a link is clicked
        links.forEach(link => {
            link.addEventListener('click', () => {
                // Jangan kunci animasi saat navigasi, tapi pastikan body scroll lepas
                document.body.style.overflow = '';
                // Optional: closeMenu() kalau ini SPA, tapi karena refresh halaman, biarkan browser handle.
                // Namun untuk UX instant feedback:
                menu.style.opacity = '0';
                menu.classList.add('hidden');
            });
        });
    });
</script>
